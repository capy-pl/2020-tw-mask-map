(this["webpackJsonpmask-map"]=this["webpackJsonpmask-map"]||[]).push([[0],{118:function(e,a,t){e.exports=t.p+"static/media/mask-enough.ab4bc8c3.svg"},119:function(e,a,t){e.exports=t.p+"static/media/mask-none.ff18c436.svg"},120:function(e,a,t){e.exports=t.p+"static/media/mask-under-ten.875bbab2.svg"},217:function(e,a,t){e.exports=t(393)},222:function(e,a,t){},336:function(e,a,t){},393:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),l=t(45),s=t.n(l),i=(t(222),t(67)),c=t(24),o=t.n(c),u=t(47),m=t(36),h=t(37),d=t(38),p=t(39),g=t(40),f=t(185),v=t.n(f),k=t(407),b=t(405),E=t(32),M=t(411),C=t(412),y=t(409),w=t(394),P=t(404),S=t(402),A=t(408),x=t(413),j=t(403);function I(e){return e.length?new Date(e).toLocaleTimeString():"\u7121"}function R(e,a,t,n){var r=O(t-e),l=O(n-a),s=O(e),i=O(t),c=Math.sin(r/2)*Math.sin(r/2)+Math.sin(l/2)*Math.sin(l/2)*Math.cos(s)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function O(e){return e*Math.PI/180}function N(){return new Promise((function(e,a){navigator.geolocation.getCurrentPosition(e,a)}))}var z=t(118),L=t.n(z),H=t(119),T=t.n(H),V=t(120),D=t.n(V),_=t(406),F=t(204),B=function(e){function a(){var e,t;Object(m.a)(this,a);for(var n=arguments.length,l=new Array(n),s=0;s<n;s++)l[s]=arguments[s];return(t=Object(d.a)(this,(e=Object(p.a)(a)).call.apply(e,[this].concat(l)))).rootRef=r.a.createRef(),t.legendRef=r.a.createRef(),t.map=void 0,t.markers=new Map,t.changeCenter=Object(u.a)(o.a.mark((function e(){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.map){e.next=6;break}return e.next=4,N();case 4:a=e.sent,t.map.panTo({lat:a.coords.latitude,lng:a.coords.longitude});case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])}))),t.onCenterChange=function(){var e=new Date;return function(){var a=new Date;a.getTime()-e.getTime()>100&&(e=a,t.drawMarkers())}},t.drawMarkers=function(){var e=t.sortedDistanceMap().slice(0,50),a=[];t.markers.forEach((function(t,n){e.includes(n)||(t.setMap(null),a.push(n))})),a.forEach((function(e){t.markers.delete(e)})),e.forEach((function(e){t.drawMarker(e)}))},t.drawMarker=function(e){if(t.markers.has(e)){var a;null===(a=t.markers.get(e))||void 0===a||a.setMap(t.map)}else{var n=t.props.pharmacies[e],r=t.maskSituation(n.properties.mask_adult),l=t.maskSituation(n.properties.mask_child),s={url:t.getIcon(r,l),scaledSize:new google.maps.Size(40,40)},i='\n        <div class="info-box">\n          <h3 class="ui top attached header">\n            '.concat(n.properties.name,'\n          </h3>\n          <table class="ui celled table">\n          <tbody>\n            <tr class="collapsing">\n              <td class="collapsing">\u5730\u5740</td>\n              <td data-label="address">').concat(n.properties.address,'</td>\n            </tr>\n            <tr class="collapsing">\n              <td  class="collapsing">\u96fb\u8a71</td>\n              <td data-label="phone number">').concat(n.properties.phone,'</td>\n            </tr>\n            <tr>\n              <td class="collapsing">\u6700\u5f8c\u66f4\u65b0\u6642\u9593</td>\n              <td data-label="last update">').concat(I(n.properties.updated||""),'</td>\n            </tr>\n            <tr>\n              <td class="collapsing ').concat(t.getCellClass(r),'">\u6210\u4eba\u53e3\u7f69\u5eab\u5b58</td>\n              <td data-label="availabe adult masks" class=" ').concat(t.getCellClass(r),'">').concat(n.properties.mask_adult,'</td>\n            </tr>\n            <tr>\n              <td class="collapsing  ').concat(t.getCellClass(l),'" >\u5b69\u7ae5\u53e3\u7f69\u5eab\u5b58</td>\n              <td data-label="available child masks" class="').concat(t.getCellClass(l),'">').concat(n.properties.mask_child,"</td>\n            </tr>\n          </tbody>\n        </table>\n        </div>\n      "),c=new google.maps.InfoWindow({content:i}),o=new google.maps.Marker({position:{lat:n.geometry.coordinates[1],lng:n.geometry.coordinates[0]},icon:s,cursor:"pointer",map:t.map});o.addListener("click",(function(){c.open(t.map,o)})),t.markers.set(e,o)}},t}return Object(g.a)(a,e),Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(o.a.mark((function e(){var a,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rootRef||!this.rootRef.current){e.next=18;break}return a={streetViewControl:!1,zoomControl:!1,mapTypeControl:!1,fullscreenControl:!1},e.prev=2,e.next=5,N();case 5:t=e.sent,a.center={lat:t.coords.latitude,lng:t.coords.longitude},a.zoom=17,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),a.center={lat:25.0451957,lng:121.5198828},a.zoom=11;case 14:this.map=new google.maps.Map(this.rootRef.current,a),this.map.addListener("center_changed",this.onCenterChange()),this.drawMarkers(),this.legendRef&&this.legendRef.current&&this.map.controls[google.maps.ControlPosition.RIGHT_TOP].push(this.legendRef.current);case 18:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){this.drawMarkers()}},{key:"sortedDistanceMap",value:function(){for(var e=this,a=[],t=0;t<this.props.pharmacies.length;t++)a[t]=t;return this.map&&a.sort((function(a,t){var n=Object(i.a)(e.props.pharmacies[a].geometry.coordinates,2),r=n[0],l=n[1],s=Object(i.a)(e.props.pharmacies[t].geometry.coordinates,2),c=s[0],o=s[1],u=e.map.getCenter().toJSON(),m=u.lat,h=u.lng,d=R(m,h,l,r),p=R(m,h,o,c);return d<p?-1:d===p?0:1})),a}},{key:"maskSituation",value:function(e){return e>10?"enough":e>0?"lessThanTen":"none"}},{key:"getIcon",value:function(e,a){return"enough"===e||"enough"===a?L.a:"lessThanTen"===e||"lessThanTen"===a?D.a:T.a}},{key:"getCellClass",value:function(e){switch(e){case"enough":return"positive";case"lessThanTen":return"warning";default:return"negative"}}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"legend",ref:this.legendRef},r.a.createElement(C.a,{compact:!0},r.a.createElement(_.a,{verticalAlign:"middle"},r.a.createElement(_.a.Item,null,r.a.createElement(F.a,{src:D.a,size:"mini"}),r.a.createElement(_.a.Content,null,r.a.createElement(_.a.Header,null,"\u53e3\u7f69\u4f9b\u61c9\u5c0f\u65bc\uff11\uff10"))),r.a.createElement(_.a.Item,null,r.a.createElement(F.a,{src:L.a,size:"mini"}),r.a.createElement(_.a.Content,null,r.a.createElement(_.a.Header,null,"\u53e3\u7f69\u4f9b\u61c9\u8db3\u5920"))),r.a.createElement(_.a.Item,null,r.a.createElement(F.a,{src:T.a,size:"mini"}),r.a.createElement(_.a.Content,null,r.a.createElement(_.a.Header,null,"\u53e3\u7f69\u552e\u7f44")))))),r.a.createElement(w.a,{style:{zIndex:40},icon:!0,labelPosition:"left",color:"facebook",onClick:this.changeCenter,className:"locate-icon"},"\u986f\u793a\u6211\u7684\u4f4d\u7f6e",r.a.createElement(E.a,{name:"location arrow"})),r.a.createElement("div",{id:"map-root",ref:this.rootRef}))}}]),a}(r.a.PureComponent),G=(t(336),function(e){function a(){var e,t;Object(m.a)(this,a);for(var n=arguments.length,l=new Array(n),s=0;s<n;s++)l[s]=arguments[s];return(t=Object(d.a)(this,(e=Object(p.a)(a)).call.apply(e,[this].concat(l)))).timer=void 0,t.lastSearchResult="",t.pageLimit=5,t.state={ajaxError:!1,notFoundError:!1,pharmacies:[],loading:!0,searchValue:"",display:[],errMessage:"",adultMaskAvailable:!1,childMaskAvailable:!1,nearest:!1,currentPage:1,pageSize:15,hasNext:!1,startPage:1,numberLeft:0,availableNums:0,pageNums:0,mapView:!1},t.fetchData=Object(u.a)(o.a.mark((function e(){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json");case 2:if((a=e.sent).status>=400&&t.setState({ajaxError:!0,errMessage:"\u7121\u6cd5\u8207\u4f3a\u670d\u5668\u9023\u7dda\u3002"}),200!==a.status){e.next=7;break}return t.setState({ajaxError:!1,loading:!1,pharmacies:a.data.features,availableNums:a.data.features.length},(function(){t.updateList({searchString:t.lastSearchResult,adultMaskAvailable:t.state.adultMaskAvailable,childMaskAvailable:t.state.childMaskAvailable})})),e.abrupt("return",a.data.features.length);case 7:return e.abrupt("return",0);case 8:case"end":return e.stop()}}),e)}))),t.searchAddress=function(e){return function(){var a=document.createElement("a");a.href="https://maps.google.com?q=".concat(e),a.target="_blank",a.click()}},t.renderPharmacy=function(e){return r.a.createElement(k.a.Row,{key:e.properties.id},r.a.createElement(k.a.Cell,null,e.properties.name),r.a.createElement(k.a.Cell,null,e.properties.address,r.a.createElement(b.a,{content:"\u9ede\u64ca\u53ef\u5207\u63db\u5230Google Map\u986f\u793a\u4f4d\u7f6e",trigger:r.a.createElement(E.a,{link:!0,name:"tag",style:{marginLeft:"0.5rem"},onClick:t.searchAddress(e.properties.address)})})),r.a.createElement(k.a.Cell,null,e.properties.phone),r.a.createElement(k.a.Cell,null,e.properties.mask_adult),r.a.createElement(k.a.Cell,null,e.properties.mask_child),r.a.createElement(k.a.Cell,null,I(e.properties.updated||"")))},t.renderPharmacyList=function(){var e=(t.state.currentPage-1)*t.state.pageSize,a=t.state.currentPage*t.state.pageSize-1<t.state.availableNums?t.state.currentPage*t.state.pageSize:t.state.availableNums;if(!t.state.notFoundError&&t.state.pharmacies.length)return t.state.display.length?t.state.display.slice(e,a).map((function(e){return t.renderPharmacy(t.state.pharmacies[e])})):t.state.pharmacies.slice(e,a).map(t.renderPharmacy)},t.onSearchValueChange=function(e){t.setState({searchValue:e.target.value})},t.toggleAdultMaskAvailable=function(){t.updateList({searchString:t.lastSearchResult,childMaskAvailable:t.state.childMaskAvailable,adultMaskAvailable:!t.state.adultMaskAvailable})},t.toggleChildrenMaskAvailable=function(){t.updateList({searchString:t.lastSearchResult,childMaskAvailable:!t.state.childMaskAvailable,adultMaskAvailable:t.state.adultMaskAvailable})},t.onSubmit=function(){var e=t.state.searchValue.trim();e?t.lastSearchResult=e:delete t.lastSearchResult,t.updateList({searchString:e,childMaskAvailable:t.state.childMaskAvailable,adultMaskAvailable:t.state.adultMaskAvailable})},t.sortByGeolocation=Object(u.a)(o.a.mark((function e(){var a,n,r,l,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N();case 3:a=e.sent,n=a.coords,r=n.latitude,l=n.longitude,s=t.state.display.slice(),c=new Map,t.state.display.forEach((function(e){var a=Object(i.a)(t.state.pharmacies[e].geometry.coordinates,2),n=a[0],s=a[1],o=R(r,l,s,n);c.set(t.state.pharmacies[e].properties.id,o)})),s.sort((function(e,a){var n=t.state.pharmacies[e].properties.id,r=t.state.pharmacies[a].properties.id,l=c.get(n),s=c.get(r);return l<s?-1:l===s?0:1})),t.setState({display:s}),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:case"end":return e.stop()}}),e,null,[[0,12]])}))),t.getPageOptions=function(){return[15,25,50].map((function(e){return{key:e,text:e.toString(),value:e}}))},t.onPageSizeChange=function(e,a){t.setState({pageSize:a.value,currentPage:1,startPage:1,pageNums:Math.ceil(t.state.availableNums/a.value)})},t.changePage=function(e){return function(){t.setState({currentPage:e})}},t.previousPages=function(){t.setState({startPage:t.state.startPage-5,currentPage:t.state.startPage-5})},t.nextPages=function(){t.setState({startPage:t.state.startPage+5,currentPage:t.state.startPage+5})},t.toggleMapView=function(){t.setState({mapView:!t.state.mapView})},t}return Object(g.a)(a,e),Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(o.a.mark((function e(){var a,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=18e4,e.next=3,this.fetchData();case 3:t=e.sent,this.updatePageNumber(t),this.timer=window.setInterval(this.fetchData,a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),delete this.timer}},{key:"updatePageNumber",value:function(e){this.setState({pageNums:Math.ceil(e/this.state.pageSize)})}},{key:"updateList",value:function(e){var a=this,t=[];this.state.pharmacies.forEach((function(n,r){a.validatePharmacy(n,e)&&t.push(r)})),this.setState({childMaskAvailable:!!e.childMaskAvailable,adultMaskAvailable:!!e.adultMaskAvailable,display:t,availableNums:t.length,pageNums:t.length/this.state.pageSize,startPage:1,currentPage:1})}},{key:"validatePharmacy",value:function(e,a){var t=!0;return a.searchString&&a.searchString.length&&(t=e.properties.address.includes(a.searchString)||e.properties.name.includes(a.searchString)),a.adultMaskAvailable&&(t=t&&e.properties.mask_adult>0),a.childMaskAvailable&&(t=t&&e.properties.mask_child>0),t}},{key:"renderPageItems",value:function(){for(var e=[],a=this.hasNext?this.state.startPage+this.pageLimit:this.state.startPage+this.numberLeft,t=this.state.startPage;t<a;t++)e.push(r.a.createElement(M.a.Item,{key:t,active:this.state.currentPage===t,onClick:this.changePage(t),as:"a"},t));return e}},{key:"render",value:function(){if(this.state.ajaxError)return r.a.createElement(C.a,null,r.a.createElement(y.a,{error:!0},r.a.createElement(y.a.Header,null,"\u7121\u6cd5\u8207\u4f3a\u670d\u5668\u9023\u7dda"),r.a.createElement(y.a.Content,null,"\u767c\u751f\u932f\u8aa4\u7684\u539f\u56e0\u53ef\u80fd\u6709\u4ee5\u4e0b\uff1a",r.a.createElement(y.a.List,null,r.a.createElement(y.a.Item,null,"\u53e3\u7f69\u4e4b\u4e82\u5df2\u7d93\u7d50\u675f\uff0c\u8ca0\u8cac\u4f9b\u61c9\u8a0a\u606f\u7684\u4f3a\u670d\u5668\u5df2\u7d93\u95dc\u9589\u3002"),r.a.createElement(y.a.Item,null,"\u60a8\u7684\u7db2\u8def\u6709\u554f\u984c\uff0c\u8acb\u60a8\u79fb\u81f4\u6536\u8a0a\u597d\u7684\u5730\u65b9\u3002"),r.a.createElement(y.a.Item,null,"\u5982\u679c\u4ee5\u4e0a\u90fd\u7121\u6cd5\u89e3\u6c7a\u60a8\u7684\u554f\u984c\uff0c\u8acb\u806f\u7e6b honesty1997@gmail.com")))));var e=r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{className:"locate-icon",icon:!0,labelPosition:"left",color:"facebook",onClick:this.sortByGeolocation},"\u5b9a\u4f4d\u6700\u8fd1\u7684\u85e5\u5c40",r.a.createElement(E.a,{name:"location arrow"})),r.a.createElement(M.a,{style:{zIndex:0},borderless:!0,fixed:"top",secondary:!0},r.a.createElement(M.a.Item,null,r.a.createElement(P.a,{onSubmit:this.onSubmit},r.a.createElement(S.a,{onChange:this.onSearchValueChange,action:{icon:"search",name:"\u641c\u5c0b",onClick:this.onSubmit},placeholder:"\u641c\u5c0b\u85e5\u5c40\u540d\u7a31\u6216\u5730\u5740"}))),r.a.createElement(M.a.Item,{style:{marginLeft:"3rem"},onClick:this.toggleMapView},"\u986f\u793aGoogle\u5730\u5716")),r.a.createElement(C.a,{id:"main"},r.a.createElement(k.a,{celled:!0},r.a.createElement(k.a.Header,null,r.a.createElement(k.a.Row,null,r.a.createElement(k.a.HeaderCell,{colSpan:5},r.a.createElement(w.a,{color:"blue",inverted:!this.state.adultMaskAvailable,onClick:this.toggleAdultMaskAvailable},"\u5c1a\u6709\u6210\u4eba\u5eab\u5b58"),r.a.createElement(w.a,{color:"blue",inverted:!this.state.childMaskAvailable,onClick:this.toggleChildrenMaskAvailable},"\u5c1a\u6709\u5b69\u7ae5\u5eab\u5b58")),r.a.createElement(k.a.HeaderCell,null,"\u6bcf\u9801\u986f\u793a",r.a.createElement(A.a,{inline:!0,onChange:this.onPageSizeChange,options:this.getPageOptions(),defaultValue:this.state.pageSize}),"\u7b46\u8cc7\u6599")),r.a.createElement(k.a.Row,null,r.a.createElement(k.a.HeaderCell,null,"\u540d\u7a31"),r.a.createElement(k.a.HeaderCell,null,"\u5730\u5740"),r.a.createElement(k.a.HeaderCell,null,"\u96fb\u8a71"),r.a.createElement(k.a.HeaderCell,null,"\u6210\u4eba\u53e3\u7f69\u5eab\u5b58"),r.a.createElement(k.a.HeaderCell,null,"\u5152\u7ae5\u53e3\u7f69\u5eab\u5b58"),r.a.createElement(k.a.HeaderCell,null,"\u8cc7\u6599\u6700\u5f8c\u66f4\u65b0\u6642\u9593"))),r.a.createElement(k.a.Body,null,this.renderPharmacyList()),r.a.createElement(k.a.Footer,null,r.a.createElement(k.a.Row,null,r.a.createElement(k.a.HeaderCell,{colSpan:"6"},r.a.createElement(M.a,{floated:"right",pagination:!0},r.a.createElement(M.a.Item,{as:"a",onClick:this.previousPages,icon:!0,disabled:1===this.state.startPage},r.a.createElement(E.a,{name:"chevron left"})),this.renderPageItems(),r.a.createElement(M.a.Item,{as:"a",onClick:this.nextPages,icon:!0,disabled:!this.hasNext},r.a.createElement(E.a,{name:"chevron right"})))))))));return r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{active:this.state.loading,page:!0},r.a.createElement(j.a,null)),this.state.mapView?r.a.createElement(B,{pharmacies:this.state.pharmacies}):e)}},{key:"hasNext",get:function(){return this.state.startPage+4<this.state.pageNums}},{key:"numberLeft",get:function(){return this.state.pageNums-this.state.startPage+1}}]),a}(r.a.PureComponent));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[217,1,2]]]);
//# sourceMappingURL=main.0f7cbef1.chunk.js.map