(this["webpackJsonpmask-map"]=this["webpackJsonpmask-map"]||[]).push([[0],{212:function(e,a,t){e.exports=t(388)},217:function(e,a,t){},236:function(e,a,t){},388:function(e,a,t){"use strict";t.r(a);var r=t(0),n=t.n(r),s=t(38),l=t.n(s),i=(t(217),t(200)),c=t(41),o=t.n(c),u=t(90),h=t(48),m=t(49),g=t(50),d=t(53),p=t(55),v=t(181),f=t.n(v),k=t(403),b=t(402),E=t(40),P=t(406),M=t(407),S=t(399),y=t(401),A=t(400),C=t(408),w=t(389),x=t(404);function N(e){return e.length?new Date(e).toLocaleTimeString():"\u7121"}function j(e,a,t,r){var n=L(t-e),s=L(r-a),l=L(e),i=L(t),c=Math.sin(n/2)*Math.sin(n/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(l)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function L(e){return e*Math.PI/180}t(236);var z=function(e){function a(){var e,t;Object(h.a)(this,a);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return(t=Object(g.a)(this,(e=Object(d.a)(a)).call.apply(e,[this].concat(s)))).timer=void 0,t.lastSearchResult="",t.pageLimit=5,t.state={ajaxError:!1,notFoundError:!1,pharmacies:[],loading:!0,searchValue:"",display:[],errMessage:"",adultMaskAvailable:!1,childMaskAvailable:!1,nearest:!1,currentPage:1,pageSize:15,hasNext:!1,startPage:1,numberLeft:0,availableNums:0,pageNums:0},t.fetchData=Object(u.a)(o.a.mark((function e(){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json");case 2:if((a=e.sent).status>=400&&t.setState({ajaxError:!0,errMessage:"\u7121\u6cd5\u8207\u4f3a\u670d\u5668\u9023\u7dda\u3002"}),200!==a.status){e.next=7;break}return t.setState({ajaxError:!1,loading:!1,pharmacies:a.data.features,availableNums:a.data.features.length},(function(){t.updateList({searchString:t.lastSearchResult,adultMaskAvailable:t.state.adultMaskAvailable,childMaskAvailable:t.state.childMaskAvailable})})),e.abrupt("return",a.data.features.length);case 7:return e.abrupt("return",0);case 8:case"end":return e.stop()}}),e)}))),t.searchAddress=function(e){return function(){var a=document.createElement("a");a.href="https://maps.google.com?q=".concat(e),a.target="_blank",a.click()}},t.renderPharmacy=function(e){return n.a.createElement(k.a.Row,{key:e.properties.id},n.a.createElement(k.a.Cell,null,e.properties.name),n.a.createElement(k.a.Cell,null,e.properties.address,n.a.createElement(b.a,{content:"\u9ede\u64ca\u53ef\u5207\u63db\u5230Google Map\u986f\u793a\u4f4d\u7f6e",trigger:n.a.createElement(E.a,{link:!0,name:"tag",style:{marginLeft:"0.5rem"},onClick:t.searchAddress(e.properties.address)})})),n.a.createElement(k.a.Cell,null,e.properties.phone),n.a.createElement(k.a.Cell,null,e.properties.mask_adult),n.a.createElement(k.a.Cell,null,e.properties.mask_child),n.a.createElement(k.a.Cell,null,N(e.properties.updated||"")))},t.renderPharmacyList=function(){var e=(t.state.currentPage-1)*t.state.pageSize,a=t.state.currentPage*t.state.pageSize-1<t.state.availableNums?t.state.currentPage*t.state.pageSize:t.state.availableNums;if(!t.state.notFoundError&&t.state.pharmacies.length)return t.state.display.length?t.state.display.slice(e,a).map((function(e){return t.renderPharmacy(t.state.pharmacies[e])})):t.state.pharmacies.slice(e,a).map(t.renderPharmacy)},t.onSearchValueChange=function(e){t.setState({searchValue:e.target.value})},t.toggleAdultMaskAvailable=function(){t.updateList({searchString:t.lastSearchResult,childMaskAvailable:t.state.childMaskAvailable,adultMaskAvailable:!t.state.adultMaskAvailable})},t.toggleChildrenMaskAvailable=function(){t.updateList({searchString:t.lastSearchResult,childMaskAvailable:!t.state.childMaskAvailable,adultMaskAvailable:t.state.adultMaskAvailable})},t.onSubmit=function(){var e=t.state.searchValue.trim();e?t.lastSearchResult=e:delete t.lastSearchResult,t.updateList({searchString:e,childMaskAvailable:t.state.childMaskAvailable,adultMaskAvailable:t.state.adultMaskAvailable})},t.sortByGeolocation=Object(u.a)(o.a.mark((function e(){var a,r,n,s,l,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getPosition();case 3:a=e.sent,r=a.coords,n=r.latitude,s=r.longitude,l=t.state.display.slice(),c=new Map,t.state.display.forEach((function(e){var a=Object(i.a)(t.state.pharmacies[e].geometry.coordinates,2),r=a[0],l=a[1],o=j(n,s,l,r);c.set(t.state.pharmacies[e].properties.id,o)})),l.sort((function(e,a){var r=t.state.pharmacies[e].properties.id,n=t.state.pharmacies[a].properties.id,s=c.get(r),l=c.get(n);return s<l?-1:s===l?0:1})),t.setState({display:l}),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:case"end":return e.stop()}}),e,null,[[0,12]])}))),t.getPageOptions=function(){return[15,25,50].map((function(e){return{key:e,text:e.toString(),value:e}}))},t.onPageSizeChange=function(e,a){t.setState({pageSize:a.value,currentPage:1,startPage:1,pageNums:Math.ceil(t.state.availableNums/a.value)})},t.changePage=function(e){return function(){t.setState({currentPage:e})}},t.previousPages=function(){t.setState({startPage:t.state.startPage-5,currentPage:t.state.startPage-5})},t.nextPages=function(){t.setState({startPage:t.state.startPage+5,currentPage:t.state.startPage+5})},t}return Object(p.a)(a,e),Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(o.a.mark((function e(){var a,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=18e4,e.next=3,this.fetchData();case 3:t=e.sent,this.updatePageNumber(t),this.timer=window.setInterval(this.fetchData,a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),delete this.timer}},{key:"updatePageNumber",value:function(e){this.setState({pageNums:Math.ceil(e/this.state.pageSize)})}},{key:"getPosition",value:function(){return new Promise((function(e,a){navigator.geolocation.getCurrentPosition(e,a)}))}},{key:"updateList",value:function(e){var a=this,t=[];this.state.pharmacies.forEach((function(r,n){a.validatePharmacy(r,e)&&t.push(n)})),this.setState({childMaskAvailable:!!e.childMaskAvailable,adultMaskAvailable:!!e.adultMaskAvailable,display:t,availableNums:t.length,pageNums:t.length/this.state.pageSize,startPage:1,currentPage:1})}},{key:"validatePharmacy",value:function(e,a){var t=!0;return a.searchString&&a.searchString.length&&(t=e.properties.address.includes(a.searchString)||e.properties.name.includes(a.searchString)),a.adultMaskAvailable&&(t=t&&e.properties.mask_adult>0),a.childMaskAvailable&&(t=t&&e.properties.mask_child>0),t}},{key:"renderPageItems",value:function(){for(var e=[],a=this.hasNext?this.state.startPage+this.pageLimit:this.state.startPage+this.numberLeft,t=this.state.startPage;t<a;t++)e.push(n.a.createElement(P.a.Item,{key:t,active:this.state.currentPage===t,onClick:this.changePage(t),as:"a"},t));return e}},{key:"render",value:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(M.a,{active:this.state.loading,page:!0},n.a.createElement(S.a,null)),n.a.createElement(b.a,{basic:!0,trigger:n.a.createElement(E.a,{className:"locate-icon ",size:"big",circular:!0,inverted:!0,link:!0,color:"grey",name:"location arrow",onClick:this.sortByGeolocation}),content:"\u5b9a\u4f4d\u986f\u793a\u96e2\u81ea\u5df1\u6700\u8fd1\u7684\u85e5\u5c40"}),n.a.createElement(P.a,{borderless:!0,fixed:"top"},n.a.createElement(P.a.Item,null,n.a.createElement(y.a,{onSubmit:this.onSubmit},n.a.createElement(A.a,{onChange:this.onSearchValueChange,action:{icon:"search",name:"\u641c\u5c0b",onClick:this.onSubmit},placeholder:"\u641c\u5c0b\u85e5\u5c40\u540d\u7a31\u6216\u5730\u5740"})))),n.a.createElement(C.a,{id:"main"},n.a.createElement(k.a,{celled:!0},n.a.createElement(k.a.Header,null,n.a.createElement(k.a.Row,null,n.a.createElement(k.a.HeaderCell,{colSpan:5},n.a.createElement(w.a,{color:"blue",inverted:!this.state.adultMaskAvailable,onClick:this.toggleAdultMaskAvailable},"\u5c1a\u6709\u6210\u4eba\u5eab\u5b58"),n.a.createElement(w.a,{color:"blue",inverted:!this.state.childMaskAvailable,onClick:this.toggleChildrenMaskAvailable},"\u5c1a\u6709\u5b69\u7ae5\u5eab\u5b58")),n.a.createElement(k.a.HeaderCell,null,"\u6bcf\u9801\u986f\u793a",n.a.createElement(x.a,{inline:!0,onChange:this.onPageSizeChange,options:this.getPageOptions(),defaultValue:this.state.pageSize}),"\u7b46\u8cc7\u6599")),n.a.createElement(k.a.Row,null,n.a.createElement(k.a.HeaderCell,null,"\u540d\u7a31"),n.a.createElement(k.a.HeaderCell,null,"\u5730\u5740"),n.a.createElement(k.a.HeaderCell,null,"\u96fb\u8a71"),n.a.createElement(k.a.HeaderCell,null,"\u6210\u4eba\u53e3\u7f69\u5eab\u5b58"),n.a.createElement(k.a.HeaderCell,null,"\u5152\u7ae5\u53e3\u7f69\u5eab\u5b58"),n.a.createElement(k.a.HeaderCell,null,"\u8cc7\u6599\u6700\u5f8c\u66f4\u65b0\u6642\u9593"))),n.a.createElement(k.a.Body,null,this.renderPharmacyList()),n.a.createElement(k.a.Footer,null,n.a.createElement(k.a.Row,null,n.a.createElement(k.a.HeaderCell,{colSpan:"6"},n.a.createElement(P.a,{floated:"right",pagination:!0},n.a.createElement(P.a.Item,{as:"a",onClick:this.previousPages,icon:!0,disabled:1===this.state.startPage},n.a.createElement(E.a,{name:"chevron left"})),this.renderPageItems(),n.a.createElement(P.a.Item,{as:"a",onClick:this.nextPages,icon:!0,disabled:!this.hasNext},n.a.createElement(E.a,{name:"chevron right"})))))))))}},{key:"hasNext",get:function(){return this.state.startPage+4<this.state.pageNums}},{key:"numberLeft",get:function(){return this.state.pageNums-this.state.startPage+1}}]),a}(n.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(n.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[212,1,2]]]);
//# sourceMappingURL=main.3852835f.chunk.js.map